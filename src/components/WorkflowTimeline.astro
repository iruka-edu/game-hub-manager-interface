---
interface Props {
  currentStatus: string;
}

const { currentStatus } = Astro.props;

const steps = [
  { id: 'draft', label: 'Nháp', role: 'Dev' },
  { id: 'uploaded', label: 'Chờ QC', role: 'QC' },
  { id: 'qc_passed', label: 'Chờ duyệt', role: 'CTO/CEO' },
  { id: 'approved', label: 'Chờ xuất bản', role: 'Admin' },
  { id: 'published', label: 'Đã xuất bản', role: '' },
];

const statusOrder = ['draft', 'uploaded', 'qc_passed', 'approved', 'published'];
const currentIndex = statusOrder.indexOf(currentStatus);
const isFailed = currentStatus === 'qc_failed';
---

<div class="flex items-center justify-between">
  {steps.map((step, index) => {
    const isCompleted = index < currentIndex;
    const isCurrent = step.id === currentStatus || (isFailed && step.id === 'uploaded');
    const isPending = index > currentIndex;
    
    return (
      <>
        <div class="flex flex-col items-center">
          <div class={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold ${
            isCompleted ? 'bg-green-500 text-white' :
            isCurrent ? (isFailed ? 'bg-red-500 text-white' : 'bg-indigo-600 text-white') :
            'bg-slate-200 text-slate-500'
          }`}>
            {isCompleted ? (
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
            ) : (
              index + 1
            )}
          </div>
          <span class={`mt-1 text-xs font-medium ${isCurrent ? 'text-indigo-600' : 'text-slate-500'}`}>
            {isFailed && step.id === 'uploaded' ? 'QC cần sửa' : step.label}
          </span>
          {step.role && (
            <span class="text-xs text-slate-400">{step.role}</span>
          )}
        </div>
        {index < steps.length - 1 && (
          <div class={`flex-1 h-0.5 mx-2 ${isCompleted ? 'bg-green-500' : 'bg-slate-200'}`}></div>
        )}
      </>
    );
  })}
</div>
